
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JSAttend - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="            JSAttend          In this project you&#8217;ll work with the attendee data for a conference supplied in a CSV file. This data comes fro...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/projects/jsattend.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js" type="text/javascript"></script>
  <script src="http://tab-slide-out.googlecode.com/files/jquery.tabSlideOut.v1.3.js"></script>

  <script type="text/javascript">
    $(function(){
      $('.slide-out-div').tabSlideOut({
        tabHandle: '.handle',                     //class of the element that will become your tab
        pathToTabImage: '/images/feedback_tab.png', //path to the image for the tab //Optionally can be set using css
        imageHeight: '150px',                     //height of tab image           //Optionally can be set using css
        imageWidth: '50px',                       //width of tab image            //Optionally can be set using css
        tabLocation: 'left',                      //side of screen where tab lives, top, right, bottom, or left
        speed: 300,                               //speed of animation
        action: 'click',                          //options: 'click' or 'hover', action to trigger animation
        topPos: '200px',                          //position from the top/ use if tabLocation is left or right
        leftPos: '20px',                          //position from left/ use if tabLocation is bottom or top
        fixedPosition: true                      //options: true makes it stick(fixed position) on scroll
        });
      });
  </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jumpstart Lab Curriculum</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yoursite.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    
    <h1 class="entry-title">JSAttend</h1>
    
  </header>
  
  <p>In this project you&#8217;ll work with the attendee data for a conference supplied in a CSV file. This data comes from an actual conference, though identifying information has been masked. </p>

<p>The techniques practiced in this lab include:</p>

<ul>
<li>Basic file input and output</li>
<li>Working with CSV (Comma Separated Value) files using the CSV library</li>
<li>String manipulation techniques</li>
<li>Basic looping and branching instructions</li>
<li>Accessing a web-based API</li>
</ul>

<div class="note">
<p>This tutorial is open source. If you notice errors, typos, or have questions/suggestions, please <a href="https://github.com/JumpstartLab/curriculum/blob/master/source/projects/jsattend.markdown">submit them to the project on Github</a>.</p>
</div>

<h2>Bootstrap</h2>

<p>If you haven&#8217;t already setup Ruby, visit <a href="/topics/environment/environment.html">the environment setup page for instructions</a>.</p>

<h3>Dependencies</h3>

<p>We&#8217;ll use just one external gem during the main sections of the tutorial. Install it with the following command and your terminal:</p>

<ul>
<li>[OS X]: <code>gem install sunlight</code></li>
<li>[Win]: <code>gem install sunlight</code></li>
</ul>

<h3>Starting the Project</h3>

<p>If you&#8217;re using RubyMine, do the following to setup the new project:</p>

<ul>
<li>Click &quot;Create a New Project&quot;

<ul>
<li>Project name: JSAttend</li>
<li>Project type: Empty Project</li>
<li>Click OK</li>
</ul></li>
<li>Right click on the project folder (in the left pane) and select NEW -&gt; RUBY CLASS

<ul>
<li>Enter the class name: JSAttend</li>
</ul></li>
</ul>

<h3>Initial Skeleton</h3>

<p>Start with this code framework:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Dependencies</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;csv&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Class Definition</span>
</span><span class='line'><span class="k">class</span> <span class="nc">JSAttend</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;JSAttend Initialized.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Script</span>
</span><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Running the Program</h3>

<h4>From Inside RubyMine</h4>

<p>In RubyMine, click the RUN menu at the top, then EDIT CONFIGURATIONS</p>

<ul>
<li>Click the [+] icon

<ul>
<li>Click RUBY</li>
<li>Set the NAME to JSAttend</li>
</ul></li>
<li>Click the [&#8230;] next to RUBY SCRIPT and select your <code>js_attend.rb</code> file</li>
<li>Click the [&#8230;] next to WORKING DIRECTORY and select the folder where your <code>js_attend.rb</code> file is stored</li>
<li>Leave everything else alone and click OK</li>
<li>Click the RUN menu then RUN or Command-F8 to execute the program</li>
</ul>

<h4>From the Terminal</h4>

<p>If you prefer to run the program from the terminal:</p>

<ul>
<li>Switch to the project directory</li>
<li>Run it with <code>ruby jsattend.rb</code></li>
</ul>

<h4>Expected Output</h4>

<p>Your output should look something like&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>

<h2>Iteration 0: Basics of a CSV File</h2>

<p>CSV files are great for storing and transporting large data sets. They&#8217;re most commonly created from spreadsheets, but since a CSV is really just a plain text file, they&#8217;re pretty easy to interact with from ANY program. </p>

<h3>Accessing the Data File</h3>

<p>The first thing to do is open the file. We can do that by adding in the <code>CSV</code> line to our <code>initialize</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Dependencies</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;csv&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Class Definition</span>
</span><span class='line'><span class="k">class</span> <span class="nc">JSAttend</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;JSAttend Initialized.&quot;</span>
</span><span class='line'>    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;event_attendees.csv&quot;</span>
</span><span class='line'>    <span class="vi">@file</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Script</span>
</span><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run the program and you should get an error that starts like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>No such file or directory - event_attendees.csv <span class="o">(</span>Errno::ENOENT<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Setup <code>event_attendees.csv</code></h3>

<p>Download the file <a href="/assets/jsattend/event_attendees.csv">event_attendees.csv</a> and store it into the <em>same directory as your <code>jsattend.rb</code></em>. Then re-run your program and you should see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>JSAttend Initialized.
</span></code></pre></td></tr></table></div></figure>

<p>Now that our file is getting loaded properly we have a name for that variable - <code>@file</code>. We can talk to that object named <code>@file</code> and ask it questions or tell it to do things. </p>

<h3>Reading Data from the File</h3>

<p>Now that we can open the file, let&#8217;s read out some data.</p>

<h4>Understanding the File Data</h4>

<p>The first question to ask is &quot;how do we read the individual lines of the file?&quot; The CSV object implements the <code>Enumerable</code> interface which means that, among other things, you can use the <code>each</code> method to go through the collection one-by-one.</p>

<p>Here, we can access one line at a time with this loop:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># Do Something</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>But what is that <code>line</code> object? Is it a String? An Array? Check it out by writing this method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_names</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">line</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>With the method inside the class, we need to call it from our script. At the bottom of your project file add the line <code>jsa.print_names</code> like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">jsa</span><span class="o">.</span><span class="n">print_names</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then <em>run the program</em> using RubyMine or the terminal. You&#8217;ll see that the <code>line</code> object looks like an Array.</p>

<h4>Default Reading</h4>

<p>We can access individual fields within that array by their position. </p>

<p>If you look at the data file, you&#8217;ll see that the first name is in the third column. Since an array is zero-indexed, the third column is position <code>2</code>. So we can print the first names like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_names</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">line</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Test it, see that it&#8217;s working, then modify this method to print both the first <em>and</em> last names for each line.</p>

<h4>Looking for Headers</h4>

<p>Using numbers to access the array isn&#8217;t very clear. When you look at the code, which position is the first name and which is the last name? It&#8217;s impossible to know without looking at the data file.</p>

<p>The data file begins with a row of headers labeling each column. The CSV library can read these headers and use them to organize the data.</p>

<p>Look in your <code>initialize</code> method, and add the extra <code>:headers</code> parameter to the <code>@file</code> line like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">{</span><span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run your existing <code>print_names</code> method and it should still work the same.</p>

<p>Then, try calling <code>inspect</code> on the line object again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_names</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="nb">inspect</span>
</span><span class='line'>      <span class="c1">#puts line[2] + &quot; &quot; + line[3]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Note that the <code>#</code> comments out the line so it won&#8217;t be executed.</p>

<p>When you look at the output, you&#8217;ll see that <code>line</code> now looks like a Hash. It has keys like <code>&quot;HomePhone&quot;</code> and <code>&quot;City&quot;</code>. Now, <em>use the keys instead of array positions</em> to print out the first and last names.</p>

<h4>Converting to Symbols</h4>

<p>It&#8217;s annoying that the weird header name formatting, with its inconsistent capitalization, is now polluting our program. The CSV library provides a way to help standardize the headers, triggered by adding another option to the loading:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">{</span><span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:header_converters</span> <span class="o">=&gt;</span> <span class="ss">:symbol</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now, in your <code>print_names</code> method, use <code>.inspect</code> to look at the structure of the <code>line</code> object. Update your <code>puts</code> instruction to use the newly standardized column names.</p>

<h2>Iteration 1: Cleaning Up the Phone Numbers</h2>

<p>Open the CSV file in a spreadsheet program like Excel or OpenOffice. Look at the phone number column &#8211; see how they&#8217;re &quot;dirty&quot;?  Some have parentheses, some have hyphens, some periods. It&#8217;s a mess; let&#8217;s clean it up.</p>

<h3>Step 0 - Print What&#8217;s There</h3>

<p>Create a method named <code>print_numbers</code> that does the same thing as your existing <code>print_names</code> method, but print the phone number from <code>line[:homephone]</code>. </p>

<p>At the bottom of your program change the <code>jsa.print_names</code> line to <code>jsa.print_numbers</code>. Run your program and you should see the existing phone numbers scroll by.</p>

<h3>Step 1 - Removing Periods</h3>

<p>When you&#8217;re cleaning up data, the process goes something like this:</p>

<ul>
<li>Copy the original data</li>
<li>Remove the junk</li>
<li>Output the newly cleaned data</li>
</ul>

<p>Simple, right?  Let&#8217;s first remove the periods that some people put in their phone numbers. Change the body of your <code>print_numbers</code> method to match this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>  <span class="n">original</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span>
</span><span class='line'>  <span class="n">clean</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">clean</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run your program and you should see the numbers scroll by again. There&#8217;s still plenty of junk in there (parentheses, hyphens, etc), but <em>there are no periods</em>!</p>

<h3>Step 2 - Removing Parentheses, Hyphens, and Spaces</h3>

<p>Now we need to remove the other junk characters. Try working with the <code>delete</code> and <code>delete!</code> methods to clean up all right parentheses, left parentheses, hyphens, and blank spaces. RUN your program and you should see better data coming out like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">6143300000</span>
</span><span class='line'><span class="mi">6176861000</span>
</span><span class='line'><span class="mi">503278000</span>
</span><span class='line'><span class="mi">7047989000</span>
</span><span class='line'><span class="mi">7579713000</span>
</span><span class='line'><span class="mi">9522007000</span>
</span><span class='line'><span class="mi">8146673000</span>
</span><span class='line'><span class="mi">19194755000</span>
</span><span class='line'><span class="mi">8045434000</span>
</span><span class='line'><span class="mi">8282844000</span>
</span><span class='line'><span class="n">bl000</span>
</span><span class='line'><span class="mi">6512603000</span>
</span></code></pre></td></tr></table></div></figure>

<p>Not perfect, but getting better.</p>

<h3>Step 3 - Checking Length</h3>

<p>We&#8217;ve removed extraneous characters, but there are still some problems. Some of the numbers are &quot;long&quot; because they have a leading 1 on the front. A few of them are too short. A few others are just garbage &#8211; like a misplaced email address or just some letter/number junk. Let&#8217;s fix these problems by looking at the number&#8217;s length.</p>

<p>The ideal length for our numbers is 10 total digits. We could write what&#8217;s called &quot;pseudocode&quot; like this:</p>

<ul>
<li>If the number is 10 digits long

<ul>
<li>It&#8217;s good</li>
</ul></li>
<li>If it&#8217;s 11 digits long

<ul>
<li>Is the first number a 1?</li>
<li>If so, cut it off the leading 1</li>
<li>If not, it&#8217;s junk</li>
</ul></li>
<li>Otherwise

<ul>
<li>If so, it&#8217;s junk.</li>
</ul></li>
</ul>

<p>Now we can translate that into real code using the <code>if</code>, <code>elsif</code>, and <code>else</code> like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">10</span>
</span><span class='line'>  <span class="c1"># Do Nothing</span>
</span><span class='line'><span class="k">elsif</span> <span class="n">number</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">11</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">number</span> <span class="o">=</span> <span class="s2">&quot;0000000000&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  <span class="n">number</span> <span class="o">=</span> <span class="s2">&quot;0000000000&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Insert that into your <code>print_numbers</code> method. RUN the resulting code and you should see nicely formatted numbers like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">3363171000</span>
</span><span class='line'><span class="mi">3363171000</span>
</span><span class='line'><span class="mi">2024818000</span>
</span><span class='line'><span class="mi">5034758000</span>
</span><span class='line'><span class="mi">8054481000</span>
</span><span class='line'><span class="mi">8145711000</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Step 4 - Refactoring</h3>

<p><em>Refactoring</em> is an important part of programming &#8211; it means taking working code and reorganizing it to make more sense, be more maintainable, and be more flexible for the future.</p>

<h4>Splitting a Method</h4>

<p>We&#8217;ve created a <code>print_numbers</code> method that prints out good-looking phone numbers, but we&#8217;re lying a little bit. It&#8217;s not just <em>printing</em> numbers; it&#8217;s <em>cleaning</em> them then <em>printing</em> them. If we&#8217;re doing two things they should be split up into two methods.</p>

<p>Create a method named <code>clean_number</code> that looks like this&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">clean_number</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># Insert your &quot;cleaning&quot; code here</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">number</span>  <span class="c1"># Send the variable &#39;number&#39; back to the method that called this method</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Note the comments that start with a <code>#</code> symbol. When you put a <code>#</code> the Ruby interpreter ignores everything after it on that line. So if we put a <code>#</code> then we can follow it with notes explaining what&#8217;s going on with that code. Comments are just for your information.</p>

<p>See where we have the <code>original</code> variable next to the name of the method?  That&#8217;s called a <em>parameter</em>. A parameter is some input that you need to put into an instruction so it can do what it&#8217;s supposed to do. Without the parameter the instruction doesn&#8217;t makes sense.</p>

<p>In order to perform <code>&quot;clean_number&quot;</code>, we need to give it the number to clean. Cut and paste your cleaning code from the old <code>print_numbers</code> method and put it into <code>clean_number</code>. After removing that code from <code>print_number</code> make it look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_numbers</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">number</span> <span class="o">=</span> <span class="n">clean_number</span><span class="p">(</span><span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">number</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Test your refactored code and make sure it still works properly.</p>

<p>If you&#8217;re generating errors, check that the variables in your <code>clean_number</code> method make sense. You&#8217;re starting with the incoming number named <code>original</code> and should end with the cleaned number named <code>number</code>.</p>

<h2>Iteration 2: Cleaning up the Zip Codes</h2>

<p>When we got this file the zipcode data was a little surprising. </p>

<h3>Step 0: Print out What&#8217;s There &amp; Diagnosis</h3>

<p>Why were so many of the zipcodes entered incorrectly?  Look at a few example addresses and zipcodes&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>1 Old Ferry Road, Box <span class="c"># 6348 Bristol RI  2809</span>
</span><span class='line'>90 University Heights , 401h1 Burlington  VT  5405
</span><span class='line'>123 Garfield Ave  Blackwood   NJ  8012
</span><span class='line'>239 S Prospect St Burlington  VT  5401
</span><span class='line'>50 Ledgewood Dr   York    ME  3909
</span></code></pre></td></tr></table></div></figure>

<p>See the pattern?  Most of the short zipcodes are in the Northeast, where many zipcodes start with a <code>0</code>. The ticket database must have stored the zipcode as an integer, which trimmed off the leading zero. Now that we know the problem, we can fix it.</p>

<p>Let&#8217;s write a method to print out the current zipcodes from the CSV. We&#8217;ll call it <code>print_zipcodes</code> and model it after our <code>print_numbers</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_zipcodes</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">zipcode</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="ss">:zipcode</span><span class="o">]</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">zipcode</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run that and you should see the list of uncleaned zipcodes scroll by.</p>

<h3>Step 1: Zero-Padding Existing Zipcodes</h3>

<p>Let&#8217;s write a little pseudo-code:</p>

<ul>
<li>If the zipcode is less than 5 digits, add zeros on to the front until it becomes five digits</li>
<li>If the zipcode is exactly 5 digits, assume it&#8217;s ok</li>
</ul>

<h4>Beginning the Implementation</h4>

<p>Turning that into code we should create a <code>clean_zipcode</code> method. Model it after the structure of your <code>clean_number</code> method. Name the parameter <code>original</code> like we did in <code>clean_number</code>. Assuming you have that structure we can start to map out the method&#8217;s code&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">clean_zipcode</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">original</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span><span class='line'>      <span class="c1"># Add zeros on the front</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="c1"># Do nothing</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#return the result</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then, to use it:</p>

<ul>
<li>In your <code>print_zipcodes</code> method change <code>zipcode = line[:zipcode]</code> to <code>zipcode = clean_zipcode(line[:zipcode])</code></li>
<li>Change the instruction at the very bottom of the script from <code>jsa.print_numbers</code> to <code>jsa.print_zipcodes</code></li>
<li>Run the program and see if it fixes the short zipcodes</li>
</ul>

<h4>Dealing with <code>nil</code></h4>

<p>Uh-oh. Did you get an error? The program got through a bunch of the zipcodes then spat this out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s1">&#39;clean_zipcode&#39;</span>: undefined method <span class="sb">`</span>length<span class="err">&#39;</span> <span class="k">for </span>nil:NilClass <span class="o">(</span>NoMethodError<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>In this case, CSV is giving us a <code>nil</code> if the CSV file doesn&#8217;t have any information in the zipcode cell.</p>

<p>Dealing with <code>nil</code> values in your code can be a huge pain in the neck. The situation we have now is very typical: you write code that works great for most of the cases, then it hits one <code>nil</code> and blows up. Most frequently these problems are generated by trying to call methods or access attributes of <code>nil</code>. The solution, then, is to check if the zipcode is <code>nil</code> before doing other things to it.</p>

<p>Here&#8217;s one approach to protect against nil:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">clean_zipcode</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">original</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;00000&quot;</span>  <span class="c1"># If it is nil, it&#39;s junk  </span>
</span><span class='line'>    <span class="k">elsif</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span><span class='line'>      <span class="c1"># Add zeros on the front</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="c1"># Do Nothing</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#return the result</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Adding the Zeros</h4>

<p>The zipcodes that are missing their leading zeros are mostly four digits long, so just adding one zero to the front would probably fix it. But 00601, for instance, is a valid zipcode. In our data there are a few of these two-leading-zero zipcodes. </p>

<p>There are several ways you can do this:</p>

<ul>
<li>Using a <code>while</code> or <code>until</code> loop</li>
<li>Calculating the number of missing zeros and adding them to the front</li>
<li>Adding a fixed number of zeros to the front and trimming the result</li>
<li>Using a method from the String API for buffering strings to a certain length</li>
</ul>

<p>See if you can make each of the four work!</p>

<h3>Step 2: Test &amp; Refactor</h3>

<p>The Ruby community has a saying &quot;Keep it DRY&quot; where DRY means Don&#8217;t Repeat Yourself. Whenever you do the same thing twice you introduce the possibility for mistakes down the road. Try to cut any repetition down inside your code. </p>

<p>If you implemented more than one of the solutions for adding the zeros, which one best communicates the purpose? That&#8217;s the one you should use.</p>

<h4>Magic Numbers</h4>

<p>Lastly, the invalid zipcode is a &quot;Magic Number&quot; inside the logic of your program. It&#8217;s likely that, during the lifetime of the program, this marker will change. And that shouldn&#8217;t really mean changing the logic of our program.</p>

<p>To improve the situation we should introduce a <em>constant</em>. A constant is a special variable that we don&#8217;t change, think of it as a way to give a name to a piece of data throughout our program. In Ruby, a constant starts with a capital letter and is usually written in all caps like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">INVALID_ZIPCODE</span> <span class="o">=</span> <span class="s2">&quot;00000&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>We normally define constants near the top of the class like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">JSAttend</span>
</span><span class='line'>  <span class="no">INVALID_ZIPCODE</span> <span class="o">=</span> <span class="s2">&quot;00000&quot;</span>
</span><span class='line'>  <span class="c1">#...everything else...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then use the <code>INVALID_ZIPCODE</code> constant instead of the string <code>&quot;00000&quot;</code> in your <code>clean_zipcode</code>.</p>

<p>RUN it and make sure there are no errors and the data looks good, then we&#8217;re ready for the next iteration!</p>

<h2>Iteration 3: Outputting Cleaned Data</h2>

<p>We&#8217;ve done good work cleaning the zipcodes and phone numbers. Let&#8217;s now output the clean data to a new file.</p>

<h3>Step 0: Print Out What&#8217;s There</h3>

<p>Let&#8217;s create a method that&#8217;ll handle writing out the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">output_data</span>
</span><span class='line'>    <span class="n">output</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;event_attendees_clean.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="n">line</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then change the line at the bottom of your program from <code>jsa.print_zipcodes</code> to <code>jsa.output_data</code>. Run the program, check that no errors were generated, then look in your project folder and you should see a file &#8216;event<em>attendees</em>clean.csv&#8217;. </p>

<p>Open that file (with Excel, Numbers, OpenOffice, or a text editor) and see that it looks like the original &#8211; almost. It&#8217;s missing the headers.</p>

<h3>Step 1: Headers</h3>

<p>How do we get the headers for the CSV? There are a few options, but the easiest is to ask one of the CSV line objects. Each line has a method <code>headers</code> that will return an array of the headers. So our method could look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">output_data</span>
</span><span class='line'>    <span class="n">output</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;event_attendees_clean.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="c1"># if this is the first line</span>
</span><span class='line'>      <span class="c1">#   output the headers</span>
</span><span class='line'>      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="n">line</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>How do we figure out if it&#8217;s the first line? The CSV object, stored in <code>@file</code>, has a <code>lineno</code> method that tells you what line it&#8217;s on. Write an <code>if</code> condition that checks if <code>@file.lineno</code> is equal to zero. If it is, output the headers with <code>output &lt;&lt; line.headers</code>.</p>

<h3>Step 2: In-Place Phone Number and Zipcode Cleaning</h3>

<p>The <code>line</code> object we&#8217;ve been working with is loaded into memory using the data in the original file. Since it&#8217;s in memory, we can make changes to <code>line</code> itself without affecting the original file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span> <span class="o">=</span> <span class="n">clean_number</span><span class="p">(</span><span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Outputting the Clean Phone Number</h4>

<p>Reading this line would start on the right side and sound like &quot;Take the value of <code>line[:homephone]</code>, put it into the <code>clean_number</code> method, then take the return value that the method gives you back and store it into <code>line[:homephone]</code>.&quot;  </p>

<p>Looking at your <code>output_data</code> method, add this line right before <code>output &lt;&lt; line</code>. Try running the code and verify that the phone numbers are cleaned up in the output file.</p>

<h4>Outputting the Clean Zipcode</h4>

<p>Next, add a similar instruction that sends <code>line[:zipcode]</code> into the <code>clean_zipcode</code> method and stores it back into <code>line[:zipcode]</code> before sending the <code>line</code> out to the output file. RUN these new instructions and check out the <code>event_attendees_clean.csv</code> file &#8211; does all the data look cleaned up?  It should!</p>

<h3>Step 3: Refactoring</h3>

<p>Now that we&#8217;ve created a second file we have a little problem. Our program is going to keep accessing the &quot;dirty&quot; data file because that&#8217;s what&#8217;s specified in our <code>initialize</code> method. But we want the flexibility to open either the dirty or clean data files, or really any new files too. What should we do?  We need to <em>parameterize</em> our filename.</p>

<ol>
<li>Look at the <code>initialize</code> method. See how it has the <code>filename</code> in the method body? Remove that line and make <code>filename</code> a parameter to <code>initialize</code>.</li>
<li>Go to the script at the bottom of the file and change the line <code>jsa = JSAttend.new</code> to read <code>jsa = JSAttend.new(&quot;event_attendees.csv&quot;)</code>.</li>
<li>Go to the working folder and delete the file <code>event_attendees_clean.csv</code></li>
<li>Run the program and see if the <code>event_attendees_clean.csv</code> is correctly regenerated</li>
</ol>

<h4>Setting the Output Filename</h4>

<p>Let&#8217;s also parameterize the filename inside <code>output_data</code>:</p>

<ol>
<li>Add a parameter <code>filename</code> to the <code>output_data</code> method</li>
<li>Change the actual filename in the <code>CSV.open</code> method call to the variable <code>filename</code></li>
<li>In the script, change <code>jsa.output_data</code> to <code>jsa.output_data(&quot;event_attendees_clean.csv&quot;)</code></li>
<li>Delete the cleaned CSV file and run everything again to make sure it&#8217;s working properly.</li>
</ol>

<h2>Iteration 4: Congressional Lookup</h2>

<p>This conference was about a political issue, and we wanted the participants to interact with their congresspeople. Since we already have their zipcodes we can take advantage of an API from the Sunlight Foundation to lookup the appropriate congresspeople.</p>

<h3>Step 0: Framework</h3>

<p>Create a method that looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">rep_lookup</span>
</span><span class='line'>    <span class="mi">20</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">line</span> <span class="o">=</span> <span class="vi">@file</span><span class="o">.</span><span class="n">readline</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">representative</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span class='line'>      <span class="c1"># API Lookup Goes Here</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:last_name</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:first_name</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:zipcode</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">representative</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>This is a little different than the other methods we&#8217;ve started with. The first part that will stand out is this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">20</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">line</span> <span class="o">=</span> <span class="vi">@file</span><span class="o">.</span><span class="n">readline</span>
</span></code></pre></td></tr></table></div></figure>

<p>The CSV library reads one line at a time. Now that we&#8217;re accessing a public API, it&#8217;s unkind to generate the traffic of looking up thousands and thousands of attendees each time we run the program &#8211; not to mention that&#8217;ll take a long time. </p>

<p>CSV doesn&#8217;t give us a way to just grab a certain number of lines from the file, so here we&#8217;ve used the <code>times</code> method on the integer <code>20</code>, creating a loop that will run twenty times. Each time through the loop it&#8217;ll pull one line from the CSV file using the <code>readline</code> method, storing it into <code>line</code>.</p>

<p>Run this code and you should see output like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'><span class="no">Nguyen</span><span class="p">,</span> <span class="no">Allison</span><span class="p">,</span> <span class="mi">20010</span><span class="p">,</span> <span class="n">unknown</span>
</span><span class='line'><span class="no">Hankins</span><span class="p">,</span> <span class="no">SArah</span><span class="p">,</span> <span class="mi">20009</span><span class="p">,</span> <span class="n">unknown</span>
</span><span class='line'><span class="no">Xx</span><span class="p">,</span> <span class="no">Sarah</span><span class="p">,</span> <span class="mi">33703</span><span class="p">,</span> <span class="n">unknown</span>
</span><span class='line'><span class="no">Cope</span><span class="p">,</span> <span class="no">Jennifer</span><span class="p">,</span> <span class="mi">37216</span><span class="p">,</span> <span class="n">unknown</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Step 1: Experimenting with the Sunlight API</h3>

<p>Most APIs work by requesting a very complicated web address. In the case of the Sunlight API, the API we&#8217;ll be accessing can be found here:</p>

<p><a href="http://services.sunlightlabs.com/api/legislators.allForZip.xml?apikey=e179a6973728c4dd3fb1204283aaccb5&zip=22182">http://services.sunlightlabs.com/api/legislators.allForZip.xml?apikey=e179a6973728c4dd3fb1204283aaccb5&amp;zip=22182</a></p>

<p>Take a close look at that address. Here&#8217;s how it breaks down:</p>

<ul>
<li><code>http://</code> : Use the HTTP protocol</li>
<li><code>services.sunlightlabs.com</code> : The server address on the internet </li>
<li><code>/api/</code> : The &#8216;folder&#8217;, used to namespace the API from the rest of their website</li>
<li><code>legislators.</code> : The object name</li>
<li><code>allForZip.</code> : The method called on that object</li>
<li><code>xml</code> : The return format expected</li>
<li><code>?</code> : Parameters to the method

<ul>
<li><code>apikey=e179a6973728c4dd3fb1204283aaccb5</code> : A registered API Key to authenticate our requests</li>
<li><code>&amp;</code> : The parameter separator</li>
<li><code>zip=22182</code> : The zipcode we want to lookup</li>
</ul></li>
</ul>

<p>We&#8217;re accessing the <code>legislators.allForZip</code> method of their API, we send in an <code>apikey</code> which is the string that identifies JumpstartLab as the accessor of the API, then at the very end we have a <code>zip</code>. Try modifying the address with your own zipcode and load the page.</p>

<p>If you&#8217;re familiar with writing HTML then this XML document probably makes some sense to you. You can see there is a <code>response</code> object that has a list of <code>legislators</code>. That list contains five <code>legislator</code> objects which each contain a ton of data about a legislator. Cool!</p>

<h3>Step 2: Dealing with XML and JSON</h3>

<p>What we want for this API lookup is a comma separated list of the first initial and the last name like this: F.Wolf, G.Connolly, J.Webb. We could retrieve the raw XML for each attendee and find the names in there, but there&#8217;s an easier way.</p>

<h4>Loading the Sunlight Gem</h4>

<p>Luigi Montanez, a developer at Sunlight Labs, created the <code>sunlight</code> gem. We call this a wrapper library because its job is to hide complexity from us. We can interact with it as a regular Ruby object, then the library takes care of fetching and parsing data from the server.</p>

<p>Up at the very top of your program is the <em>Dependencies</em> section. There, add a <code>require</code> to load the <code>sunlight</code> gem.  Remember, you have to install the gem before adding the <code>require</code> line.  To do so, type <code>gem install "sunlight"</code> into your command line.</p> 

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sunlight&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Set the API Key</h4>

<p>Just like the request we examined in the browser, all our requests to the Sunlight API need to be signed with our API key.</p>

<p>Just below your <code>INVALID_EMAIL</code> and <code>INVALID_PHONE_NUMBER</code> constants, set the API key within the library like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Sunlight</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;e179a6973728c4dd3fb1204283aaccb5&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Accessing the API</h4>

<p>Now what can we actually DO with the <code>Sunlight</code> library?  Check out the README on the project homepage: <a href="http://github.com/sunlightlabs/ruby-sunlightapi">http://github.com/sunlightlabs/ruby-sunlightapi</a></p>

<p>We&#8217;re interested in the <code>Legislator</code> object. Looking at the examples in the ReadMe you&#8217;ll see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">congresspeople</span> <span class="o">=</span> <span class="no">Sunlight</span><span class="o">::</span><span class="no">Legislator</span><span class="o">.</span><span class="n">all_for</span><span class="p">(</span><span class="ss">:address</span> <span class="o">=&gt;</span> <span class="s2">&quot;123 Fifth Ave New York, NY 10003&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>That&#8217;s how to fetch information for a specific address, but our task is to find them via zipcode. Look back at the URL we used to view the XML. See how it has <code>legislators.allForZip</code>?  The wrapper library should have a similar method. If you dig into the project&#8217;s source code, open the <code>lib</code> folder, open the <code>sunlight</code> folder, then <code>legislator.rb</code>. Search the page for <code>zipcode</code> and find a method that starts like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all_in_zipcode</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure> 

<p>Perfect!  It takes in a zipcode and returns a list of legislators. </p>

<h4>Fetching Legislators</h4>

<p>Let&#8217;s try it within the loop of our <code>rep_lookup</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">legislators</span> <span class="o">=</span> <span class="no">Sunlight</span><span class="o">::</span><span class="no">Legislator</span><span class="o">.</span><span class="n">all_in_zipcode</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">legislators</span>
</span></code></pre></td></tr></table></div></figure> 

<p>Run your program and check out the results. </p>

<h4>Accessing Legislator Attributes</h4>

<p>Did it work? You&#8217;re probably seeing lines like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#&lt;Sunlight::Legislator:0x102525280&gt;</span>
</span></code></pre></td></tr></table></div></figure> 

<p>That&#8217;s ruby&#8217;s way of printing out a <code>Legislator</code> object. Not very informative, but it shows us that legislators are being found which is good!  </p>

<p>Next we should access the name of the legislator within that object &#8211; but how do we know what it&#8217;s called?  Return to the <code>legislator.rb</code> source code and, near the top of the page, you&#8217;ll see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">attr_accessor</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:firstname</span><span class="p">,</span> <span class="ss">:middlename</span><span class="p">,</span> <span class="ss">:lastname</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:name_suffix</span><span class="p">,</span> <span class="ss">:nickname</span><span class="p">,</span><span class="ss">:party</span><span class="p">,</span> <span class="ss">:state</span><span class="p">,</span> <span class="ss">:district</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:gender</span><span class="p">,</span> <span class="ss">:phone</span><span class="p">,</span> <span class="ss">:fax</span><span class="p">,</span> <span class="ss">:website</span><span class="p">,</span> <span class="ss">:webform</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:congress_office</span><span class="p">,</span> <span class="ss">:bioguide_id</span><span class="p">,</span> <span class="ss">:votesmart_id</span><span class="p">,</span> <span class="ss">:fec_id</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:govtrack_id</span><span class="p">,</span> <span class="ss">:crp_id</span><span class="p">,</span> <span class="ss">:event_id</span><span class="p">,</span> <span class="ss">:congresspedia_url</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:youtube_url</span><span class="p">,</span> <span class="ss">:twitter_id</span><span class="p">,</span> <span class="ss">:fuzzy_score</span><span class="p">,</span> <span class="ss">:in_office</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:senate_class</span><span class="p">,</span> <span class="ss">:birthdate</span>
</span></code></pre></td></tr></table></div></figure> 

<p>This is a list of all the attributes (<code>attr_accessor</code> means &quot;attribute accessor&quot;) that a <code>Legislator</code> has, all the information it knows. If we want their URL we ask for <code>.website</code>, or fax number with <code>.fax</code>. Here we&#8217;re interested in their first and last name. </p>

<p>We&#8217;ll need to loop through <code>each</code> of the legislators &#8211; <em>replace</em> the <code>puts legislators</code> line with this code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">legislators</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">leg</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">leg</span><span class="o">.</span><span class="n">firstname</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run your program and check out the results. More impressive, right?</p>

<h3>Step 3: Pulling Names and Formatting the Output</h3>

<p>You can see that it&#8217;s finding one or more representatives and spewing their first names out. But we want just the first initial and last name. We need to query each legislator object and fetch the first initial and last name. We should gather these results into an array so they can be printed all at once.</p>

<h4>Using <code>.collect</code></h4>

<p>Ruby collections, like our <code>legislators</code> object, have a method named <code>.collect</code>. It accepts a block parameter, runs that block once for each element in the collection, then returns an array of the results.</p>

<p>For example, you could do this in IRB:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='irb'><span class='line'><span class="go">&gt; [1,2,3].collect do |i|</span>
</span><span class='line'><span class="go">&gt;   i*10</span>
</span><span class='line'><span class="go">&gt; end</span>
</span><span class='line'><span class="go"># =&gt; [10, 20, 30] </span>
</span></code></pre></td></tr></table></div></figure>

<p>Collect goes through the list, runs the block, and returns the collected results.</p>

<h4><code>.collect</code> on <code>legislators</code></h4>

<p>We can use that approach with our <code>legislators</code> collection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">names</span> <span class="o">=</span> <span class="n">legislators</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">leg</span><span class="o">|</span>
</span><span class='line'>  <span class="n">first_name</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">first_name</span>
</span><span class='line'>  <span class="n">first_initial</span> <span class="o">=</span> <span class="n">first_name</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>  <span class="n">last_name</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">last_name</span>
</span><span class='line'>  <span class="n">first_initial</span> <span class="o">+</span> <span class="s2">&quot;. &quot;</span> <span class="o">+</span> <span class="n">last_name</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>That last line looks a little funny because it isn&#8217;t being stored anywhere. The last line of a block is going to create the &quot;return value&quot; for the whole block, so in this case it will build the string that gets gathered by <code>.collect</code>. Our <code>names</code> array will now hold the formatted strings for each legislator.</p>

<h4>Printing the Results</h4>

<p>Change the final <code>puts</code> line in the method so it looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:last_name</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:first_name</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:zipcode</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">names</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>The significant change being the last part that says <code>names.join(&quot;, &quot;)</code>. Calling the <code>.join</code> method means &quot;take each thing in the list <code>names</code> and <code>join</code> them together with a comma and space between each one.&quot;  Run your program and you should see output like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'><span class="no">Nguyen</span><span class="p">,</span> <span class="no">Allison</span><span class="p">,</span> <span class="mi">20010</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">Norton</span>
</span><span class='line'><span class="no">Hankins</span><span class="p">,</span> <span class="no">SArah</span><span class="p">,</span> <span class="mi">20009</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">Norton</span>
</span><span class='line'><span class="no">Xx</span><span class="p">,</span> <span class="no">Sarah</span><span class="p">,</span> <span class="mi">33703</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">Martinez</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">Nelson</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">Young</span>
</span><span class='line'><span class="no">Cope</span><span class="p">,</span> <span class="no">Jennifer</span><span class="p">,</span> <span class="mi">37216</span><span class="p">,</span> <span class="n">J</span><span class="o">.</span><span class="n">Cooper</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">Corker</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">Alexander</span>
</span><span class='line'><span class="no">Zimmerman</span><span class="p">,</span> <span class="no">Douglas</span><span class="p">,</span> <span class="mi">50309</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">Harkin</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">Grassley</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">Boswell</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Extra Challenges</h4>

<ol>
<li>Output the party in parens like <code>&quot;E.Norton (D)&quot;</code></li>
<li>Prefix the name with their title <code>&quot;Sen&quot;</code>, <code>&quot;Rep&quot;</code>, or <code>&quot;Del&quot;</code></li>
</ol>

<h2>Iteration 5: Form Letters</h2>

<p>Every organization has to generate form letters and somehow it seems to always be a pain in the neck. Here&#8217;s one way we could do it with Ruby and HTML.</p>

<h3>Step 0: Framework &amp; Goals</h3>

<p>First, download the HTML form letter here: <a href="/assets/jsattend/form_letter.html">form_letter.html</a></p>

<p>Open that HTML file in your editor and check out the structure. You&#8217;ll see markers like <code>#first_name</code> which we can use to fill in the attendee&#8217;s details.</p>

<h4>Adding the Method</h4>

<p>Next, add a method to your <code>JSAttend</code> class like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">create_form_letters</span>
</span><span class='line'>    <span class="n">letter</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;form_letter.html&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'>    <span class="mi">20</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">line</span> <span class="o">=</span> <span class="vi">@file</span><span class="o">.</span><span class="n">readline</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Do your string substitutions here</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p><code>File.open</code> tells Ruby to look for a file named <code>form_letter.html</code> and the <code>&quot;r&quot;</code> tells it to open it read-only. The <code>.read</code> method says &quot;load the whole file as a string&quot; and we save it into <code>letter</code>. </p>

<h3>Step 1: Customizing the Text</h3>

<p>Use the <code>gsub</code> method to find the markers in the text and replace them with the data from <code>line</code>. <code>gsub</code> takes two parameters: the first is the string to search for and the second is the string to replace it with.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">custom_letter</span> <span class="o">=</span> <span class="n">letter</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;#firstname&quot;</span><span class="p">,</span><span class="n">firstname</span><span class="p">)</span>
</span><span class='line'><span class="n">custom_letter</span> <span class="o">=</span> <span class="n">custom_letter</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;#lastname&quot;</span><span class="p">,</span><span class="n">lastname</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>Continue writing <code>gsub</code> lines like the last one for your other variables.</p>

<h3>Step 2: Writing out the File</h3>

<p>Now that you&#8217;re creating the customized text you need to output it to a file. </p>

<h4>Creating an <code>output</code> Directory</h4>

<p>To keep the output files separate from your program, create a directory named <code>output</code> inside your project directory.</p>

<h4>Writing the Files</h4>

<p>You can create a filename, open the file, and write the <code>custom_letter</code> to that file with these instructions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;output/thanks_</span><span class="si">#{</span><span class="n">lastname</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">firstname</span><span class="si">}</span><span class="s2">.html&quot;</span>
</span><span class='line'><span class="n">output</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">custom_letter</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Check the Results</h4>

<p>Run the method from your script and examine the output. Are all the markers replaced correctly?</p>

<h2>Iteration 6: Time Targeting</h2>

<p>The boss is already thinking about the next conference: &quot;Next year I want to make better use of our Google and Facebook advertising. Find out which hours of the day the most people registered so we can run more ads during those hours.&quot;  Interesting!</p>

<h3>Step 0: Framework</h3>

<p>We&#8217;ll create a list of 24 slots, one for each hour of the day. Each slot will start with a count of zero. We&#8217;ll go through the registrant list and, for each one, increase the hour that they registered by one. Then we&#8217;ll print out the list of hours with their total registration counts.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">time_stats</span>
</span><span class='line'>    <span class="n">hours</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">24</span><span class="p">){</span><span class="mi">0</span><span class="p">}</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="c1"># Do the counting here</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">hours</span><span class="o">.</span><span class="n">each_with_index</span><span class="p">{</span><span class="o">|</span><span class="n">counter</span><span class="p">,</span><span class="n">hour</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">hour</span><span class="si">}</span><span class="se">\t</span><span class="si">#{</span><span class="n">counter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>A First Run</h4>

<p>Change the instruction in your script to <code>jsa.rank_times</code> and run it. You should see a column of hours (0 to 23) and a column of totals (all zero). </p>

<p>The only thing new here is the method <code>each_with_index</code>. It works just like <code>each</code>, but it includes an <code>index</code> value which indicates the current element&#8217;s position in the list. So for the first item in the list, the <code>index</code> is <code>0</code>, for the second it is <code>1</code> and so on. </p>

<h3>Step 1: Find the Hour &amp; Update the Counter</h3>

<p>If you look at the spreadsheet you&#8217;ll see that the <code>regdate</code> field data looks like this: <code>11/12/08 10:47</code>. We need a way to pull out just the hour. </p>

<h4>Understanding <code>.split</code></h4>

<p>We&#8217;ll use the method <code>.split</code> to help us out. <code>split</code> takes one parameter which is the string that you want to split on. So if my string were <code>&quot;hello jumpstart lab&quot;</code> and I called <code>.split(&quot; &quot;)</code> on it, Ruby would split it up each time it finds a space and give me back a list like this: <code>[&quot;hello&quot;,&quot;jumpstart&quot;,&quot;lab&quot;]</code>.</p>

<p>Once you have that array, you can pull out individual parts by position. If I wanted the first chunk I would ask for <code>[0]</code>, or the second would be <code>[1]</code>, or the third <code>[2]</code>. Check out this example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">my_string</span> <span class="o">=</span> <span class="s2">&quot;hello and welcome to jumpstart lab&quot;</span>
</span><span class='line'><span class="n">parts</span> <span class="o">=</span> <span class="n">my_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="c1"># This would print out &quot;hello&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">parts</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="c1"># This would print out &quot;to&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Parsing the Regdate</h4>

<p>Go into an IRB terminal and enter <code>timestamp = &quot;11/12/08 10:47&quot;</code>. Then experiment with using <code>split</code>. How can you pull out just the <code>10</code>?  HINT: You&#8217;ll need to use <code>split</code> twice. </p>

<h4>Incrementing the Counter</h4>

<p>Once you figure it out, write code in your <code>rank_times</code> method that pulls out the hour and stores it into the variable <code>hour</code>. Once you know the <code>hour</code>, you can update the counter by doing this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">hours</span><span class="o">[</span><span class="n">hour</span><span class="o">]</span> <span class="o">=</span> <span class="n">hours</span><span class="o">[</span><span class="n">hour</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Checking Results</h4>

<p>Once you think you&#8217;ve got it, run the method. My first few lines look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'><span class="mi">0</span> <span class="mi">276</span>
</span><span class='line'><span class="mi">1</span> <span class="mi">68</span>
</span><span class='line'><span class="mi">2</span> <span class="mi">41</span>
</span><span class='line'><span class="mi">3</span> <span class="mi">9</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Step 2: Requirements Always Change</h3>

<p>The big boss gets excited about the results from your hourly tabulations. It looks like there are some hours that are clearly more important than others. But now, tantalized, she wants to know &quot;What days of the week did most people register?&quot;</p>

<p>Given that you&#8217;re pretty much a genius programmer at this point, I&#8217;ll just give you some tips:</p>

<ul>
<li>Create a method named <code>day_stats</code></li>
<li>Create an array list, just like you did for <code>hours</code> but call it <code>days</code> and make the size <code>7</code></li>
<li>Turn a string like <code>11/12/08</code> into a Ruby Date with this instruction:

<ul>
<li><code>date = Date.strptime(&quot;11/12/08&quot;, &quot;%m/%d/%Y&quot;)</code></li>
</ul></li>
<li>Once you have a <code>date</code> object, you can get the numeric day of the week by calling the <code>.wday</code> method. Note that Sunday is <code>0</code> and Saturday is <code>6</code></li>
<li>Which two days have dominantly more registrations than the others?</li>
</ul>

<h2>Iteration 7: State Stats</h2>

<p>So you cleaned up the data, output the file, and sent it to your team. &quot;Hey, that data looks great,&quot; they say, &quot;it makes me wonder about our stats. Can you tell us more about our attendees?&quot;  Of course you can.</p>

<h3>Step 0: Goals &amp; Framework</h3>

<p>Let&#8217;s start with state-based information. How many attendees are from each state?  Let&#8217;s output a list in the format &quot;State: Attendee&quot; count, like &quot;MD: 26&quot;. We&#8217;ll put it together in a method called <code>state_stats</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">state_stats</span>
</span><span class='line'>    <span class="n">state_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>In the second line there we&#8217;ve created a <em>Hash</em> named <code>state_stats</code>.</p>

<h3>Step 1: Counting with a Hash</h3>

<p>In this case, we&#8217;ll use our Hash to keep track of how many attendees are from each state. Imagine if we were sorting out paper attendee registrations by hand:</p>

<p>For each attendee&#8230;</p>

<ul>
<li>Figure out which state they&#8217;re from</li>
<li>If a bucket does not exist for that state, create the bucket then put the paper in there</li>
<li>If a bucket exists for that state, put the paper in there</li>
<li>At the end, the number of papers in each bucket shows how many attendees are from that state</li>
</ul>

<h4>Building the Counter</h4>

<p>Inside the <code>@file.each</code> loop, let&#8217;s add instructions to implement this logic:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">state_stats</span>
</span><span class='line'>    <span class="n">state_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">state</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="ss">:state</span><span class="o">]</span>  <span class="c1"># Find the State</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">state_data</span><span class="o">[</span><span class="n">state</span><span class="o">].</span><span class="n">nil?</span> <span class="c1"># Does the state&#39;s bucket exist in state_data?</span>
</span><span class='line'>        <span class="n">state_data</span><span class="o">[</span><span class="n">state</span><span class="o">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># If that bucket was nil then start it with this one person</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">state_data</span><span class="o">[</span><span class="n">state</span><span class="o">]</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">[</span><span class="ss">:state</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># If the bucket exists, add one</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Running the Method</h4>

<p>Change your script to call the method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;event_attendees_clean.csv&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">jsa</span><span class="o">.</span><span class="n">state_stats</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run that program. Did it work?  If it generated an error, get it fixed. If there was no error, though, you probably have no idea if it worked. We didn&#8217;t print out anything. Let&#8217;s add that in now.</p>

<h4>Printing a Hash</h4>

<p>We&#8217;re collecting all the state stats in a <em>hash</em>. A hash is made up of &quot;key-value pairs&quot; &#8211; the &quot;key&quot; is the address that helps us find what we&#8217;re looking for. The &quot;value&quot; is the data that the address is pointing to. Each key points to one value. When we have a collection of these key-value pairs, we frequently want to walk through the list and do something to each pair. This state data is a perfect example.</p>

<p>What we really want is to print out lines like &quot;CA: 206&quot;. &quot;CA&quot;, the state abbreviation, is the key of the key-value pair while the number of attendees, 206, is the value of the pair. Ruby has a really great way of walking through collections like this using the <code>each</code> method, like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">state_data</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">key</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">value</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>The <code>each</code> method means &quot;take each pair in this hash and <code>do</code> what&#8217;s inside this <code>do</code>/<code>end</code> block of code. Right after the <code>do</code> is a part that trips up a lot of people. </p>

<p>We need to give the data names. <code>|key,value|</code> basically translates to &quot;for each pair, call the first thing <code>key</code> and the second thing <code>value</code>&quot;. There&#8217;s nothing magical about these particular names, they can be whatever makes sense to you. In this case, actually, we can be more explicit with our naming. Go ahead and add the following code before the <code>end</code> statement of your <code>state_stats</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">state_data</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">counter</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">state</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">counter</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Slightly Improved Output</h4>

<p>Run this code to see what you get. Mine looks like this&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'><span class="no">ND</span>
</span><span class='line'><span class="mi">11</span>
</span><span class='line'><span class="no">AL</span>
</span><span class='line'><span class="mi">26</span>
</span><span class='line'><span class="no">VA</span>
</span><span class='line'><span class="mi">382</span>
</span><span class='line'><span class="no">NY</span>
</span><span class='line'><span class="mi">503</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Step 2: Cleaning up the Output</h3>

<p>Getting there, but not quite right. We want it to look like <code>ND: 11</code>, not have <code>ND</code> and <code>11</code> on different lines. Look at the <code>each</code> loop where we have the lines <code>puts state</code> and <code>puts counter</code>. Take out those two and replace them with this interpolated string:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">counter</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>This line could be read as &quot;printout whatever is in the variable named <code>state</code>, then a colon, then a space, then whatever is in the variable named <code>counter</code>.&quot;  Once you&#8217;ve put in this improved <code>puts</code> line, RUN your code and you should see output like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'><span class="no">ND</span><span class="p">:</span> <span class="mi">11</span>
</span><span class='line'><span class="no">AL</span><span class="p">:</span> <span class="mi">26</span>
</span><span class='line'><span class="no">VA</span><span class="p">:</span> <span class="mi">382</span>
</span></code></pre></td></tr></table></div></figure>

<p>Looking good!</p>

<h3>Step 3: Sorting</h3>

<p>A hash is just a group of key-value pairs. They don&#8217;t have an inherit order &#8211; and this really frustrates a lot of people. You probably noticed that your output came out in some arbitrary order. It&#8217;s not alphabetical by state, it&#8217;s not by region, it&#8217;s not by ascending or descending totals. These would all be reasonable ways to sort the hash, but we haven&#8217;t told Ruby which to use.</p>

<h4>Using <code>sort_by</code></h4>

<p>Thankfully hash has a method named <code>sort_by</code>. Using <code>sort_by</code> we can get the hash sorted by any criteria we wish. It uses a similar syntax to <code>each</code> that we used above. Here&#8217;s how you could sort this hash alphabetically by the state name:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">state_data</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">counter</span><span class="o">|</span> <span class="n">state</span> <span class="k">unless</span> <span class="n">state</span><span class="o">.</span><span class="n">nil?</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>Reading this would sound like &quot;take the <code>state_data</code> hash and sort it by looking at each pair, name the key <code>state</code> and name the value <code>counter</code>, then compare the <code>state</code> of each pair and ignore the value of <code>counter</code>. </p>

<p>This will result in an ascending alphabetical sort, and save those results back into the name <code>state_data</code>. Try it in your code by sorting the data before printing it like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">state_data</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">counter</span><span class="o">|</span> <span class="n">state</span> <span class="k">unless</span> <span class="n">state</span><span class="o">.</span><span class="n">nil?</span><span class="p">}</span>
</span><span class='line'><span class="n">state_data</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">counter</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">counter</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run your code and you should see output like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'><span class="no">AK</span><span class="p">:</span> <span class="mi">2</span>
</span><span class='line'><span class="no">AL</span><span class="p">:</span> <span class="mi">26</span>
</span><span class='line'><span class="no">AR</span><span class="p">:</span> <span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Sorting by Registration Count</h4>

<p>Now, try modifying the <code>sort_by</code> instruction to sort by <code>counter</code> instead of state. See how that affects your output. You can also try reversing the list by putting <code>.reverse</code> on the end of the <code>sort_by</code> method (right after the <code>}</code>).</p>

<h3>Step 4: Alphabetical Order with Numbered Rank</h3>

<p>This is really a little bit advanced for this point of your development, but here&#8217;s how you could implement an alphabetical state list combined with an attendance-count ranking.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ranks</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">counter</span><span class="o">|</span> <span class="n">counter</span><span class="p">}</span><span class="o">.</span><span class="n">collect</span><span class="p">{</span><span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">counter</span><span class="o">|</span> <span class="n">state</span><span class="p">}</span><span class="o">.</span><span class="n">reverse</span>
</span><span class='line'><span class="n">state_data</span> <span class="o">=</span> <span class="n">state_data</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">counter</span><span class="o">|</span> <span class="n">state</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">state_data</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">state</span><span class="p">,</span> <span class="n">counter</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="si">#{</span><span class="n">counter</span><span class="si">}</span><span class="se">\t</span><span class="s2">(</span><span class="si">#{</span><span class="n">ranks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>The most significant change is the first line. The <code>state_data.sort_by{|state, counter| counter}</code> is just the same as the sorting by the <code>counter</code> that you did before. Once I have that ordered list, I don&#8217;t care any more about the actual counts anymore, I only care about the order. </p>

<p>I then use the <code>collect</code> method to pull out the state names&#8230;basically &quot;for each pair in the hash, name the key of the pair <code>state</code> and the value of the pair <code>counter</code>, then give me just the <code>state</code>.&quot;  The results of this <code>collect</code> are put into the array list named <code>ranks</code>. If you were to print it out, this would look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">MH</span><span class="p">,</span><span class="no">BC</span><span class="p">,</span><span class="no">NV</span><span class="p">,</span><span class="no">WY</span><span class="p">,</span><span class="no">DE</span><span class="p">,</span><span class="no">NS</span><span class="p">,</span><span class="no">QC</span><span class="p">,</span><span class="no">AS</span><span class="p">,</span><span class="no">OK</span><span class="p">,</span><span class="no">AK</span><span class="p">,</span><span class="no">PW</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>

<p>This list start with MH because it has 1 registrant and ends with NY because of its 503 registrants. I want my rankings in the opposite order (where the first position is the highest <code>counter</code>), so I added a <code>.reverse</code> to flip it around.</p>

<p>Then the second change is this line: <code>puts &quot;#{state}:\t#{counter}\t(#{ranks.index(state) + 1})&quot;</code>. The first thing I&#8217;ve changed is putting in <code>\t</code> which inserts a tab instead of a space so the output is more readable. </p>

<p>The interesting part is <code>#{ranks.index(state) + 1}</code> which reads as &quot;look in the list <code>ranks</code> and find the <code>index</code> (or &quot;position&quot;) of whatever is in the variable named <code>state</code> then add <code>1</code> to that address.&quot;  The list is indexed starting with zero; we add one so that the state rankings start at &quot;1&quot; like you&#8217;d normally rank things. Run this code and you should see output like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'><span class="no">AK</span><span class="p">:</span>    <span class="mi">2</span>   <span class="p">(</span><span class="mi">53</span><span class="p">)</span>
</span><span class='line'><span class="no">AL</span><span class="p">:</span>    <span class="mi">26</span>  <span class="p">(</span><span class="mi">35</span><span class="p">)</span>
</span><span class='line'><span class="no">AR</span><span class="p">:</span>    <span class="mi">3</span>   <span class="p">(</span><span class="mi">51</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<h1>And with that, you&#8217;re done!</h1>

  
    <footer>
      
      
        <div class="sharing">
  
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Jumpstart Lab -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


  

  

  

  <div class="slide-out-div">
  <a class="handle" href="#">Feedback</a>
  <h3>Have Feedback?</h3>
  <p>Did you find an error? Something confusing? We'd love your help:</p>
  <ul>
    <li><a href="#" id="edit_source">Edit the source code of this page directly on Github</a></li>
    <li><a href="https://github.com/JumpstartLab/curriculum/issues">Create a new issue on the project's Github page</a></li>
  </ul>
  <p>Thanks!</p>
</div>

<script>
  var pathname = window.location.pathname.replace( ".html", ".markdown" );
  var github_url = "https://github.com/JumpstartLab/curriculum/blob/master/source" + pathname;
  $("a#edit_source").attr('href', github_url);
</script>

</body>
</html>
